<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🐅&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>重啟北護課程查詢系統 Day 1 - 頁面爬蟲&nbsp;|&nbsp;ChinLin’s Blog</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="重啟北護課程查詢系統 Day 1 - 頁面爬蟲">
  
    <meta name="description" content="北護課程查詢系統能復活嗎? Day 1 嘗試中…">
    <meta property="og:description" content="北護課程查詢系統能復活嗎? Day 1 嘗試中…">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;🐅&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2529def0-9031-44bd-94d3-e6da4b9e887c%2F%E5%86%A0%E8%B2%93%E6%80%9D%E8%80%83.png?table=block&amp;id=721d7aeb-cf52-4f6f-9a86-648e0e7bfcb1"></span>&nbsp;
          
          <span>關於我</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">重啟北護課程查詢系統 Day 1 - 頁面爬蟲</h1>
    
      <div class="DateTagBar">
        
          <span class="DateTagBar__Item DateTagBar__Date">Posted on Thu, Feb 8, 2024</span>
        
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/Node.JS.html">Node.JS</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--green">
            <a href="tag/Web.html">Web</a>
          </span>
        
          <span class="DateTagBar__Item DateTagBar__Tag DateTagBar__Tag--yellow">
            <a href="tag/JS.html">JS</a>
          </span>
        
      </div>
    
  </header>
  <article id="https://www.notion.so/cd1504fd12ff4f799e139aa8b424f393" class="PageRoot"><div id="https://www.notion.so/d8aa2167863d480d9782b3d697930379" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">在實作第三方的北護課程查詢系統，我們必須要先有資料才能夠實作，這篇將紀錄如何爬北護的課程查詢系統</span></span></p></div><h1 id="https://www.notion.so/03317d46c58b40aa98f372366e876639" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/03317d46c58b40aa98f372366e876639"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">檢查頁面 (動態頁面 or 資料 API)</span></span></h1><div id="https://www.notion.so/d2b89ede9a1d4970b59f589a679b3a1a" class="ColorfulBlock ColorfulBlock--BgBlue Callout"><div class="Callout__Icon"><div class="Icon">👉🏻</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">懶人包： 動態頁面</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/33a736f1afd0415cb950db5b25fa0a7b" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">首先我們先打開課程查詢系統，F12 開啟開發者工具，選擇 Network 區塊</span></span></li></ul><div id="https://www.notion.so/4cc7eae344ac4edca14c6892982f4359" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F27974d91-2edd-448f-b17e-85cd29d98084%2FUntitled.png?width=755&amp;table=block&amp;id=4cc7eae3-44ac-4edc-a14c-6892982f4359"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F27974d91-2edd-448f-b17e-85cd29d98084%2FUntitled.png?width=755&amp;table=block&amp;id=4cc7eae3-44ac-4edc-a14c-6892982f4359" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/6d95b8cd24a4475c932a9a63a124e361" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">然後選擇學期和點擊查詢</span></span></li></ul><div id="https://www.notion.so/d630eee36dfc4ec0ae092eaa4aa5a258" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F6a96df85-91f9-4434-9a1d-68874946833a%2FUntitled.png?width=1226&amp;table=block&amp;id=d630eee3-6dfc-4ec0-ae09-2eaa4aa5a258"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F6a96df85-91f9-4434-9a1d-68874946833a%2FUntitled.png?width=1226&amp;table=block&amp;id=d630eee3-6dfc-4ec0-ae09-2eaa4aa5a258" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/30c862cf231e40bb9536f59d2adb6508" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">從他發出去的 request  (QueryCorse.aspx) 和 response，我們可以發現它是一個</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">動態頁面</strong></mark></span><span class="SemanticString">，沒有一個資料 API 可以直接獲取資料</span></span></li></ul><div id="https://www.notion.so/771450077e94483285a0f2d809506920" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2Fd012f978-ecef-4134-b649-5a27c182d203%2FUntitled.png?width=1318&amp;table=block&amp;id=77145007-7e94-4832-85a0-f2d809506920"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2Fd012f978-ecef-4134-b649-5a27c182d203%2FUntitled.png?width=1318&amp;table=block&amp;id=77145007-7e94-4832-85a0-f2d809506920" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><blockquote id="https://www.notion.so/2753db9cf7b24fa9847b7bce3d354532" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">因為是動態頁面，就只能用 Debug 瀏覽器的方式獲取資料</span></span></blockquote><h1 id="https://www.notion.so/60bda7595c544649a38134fbc549f1f5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/60bda7595c544649a38134fbc549f1f5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">課程資料</span></span></h1><ul class="BulletedListWrapper"><li id="https://www.notion.so/53df8391df4c421b80de203a690ad7d7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在整個頁面當中，我們所要的資料完完整整的在下方展示給我們看，學校也沒有做 pagination (分頁) 的功能，所以我們只要透過 F12 逐行分析即可</span></span></li></ul><div id="https://www.notion.so/e588af9f603f43ecbca25233666870f6" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F3c3178a2-948b-4698-97f2-6de2ebd148df%2FUntitled.png?width=1893&amp;table=block&amp;id=e588af9f-603f-43ec-bca2-5233666870f6"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F3c3178a2-948b-4698-97f2-6de2ebd148df%2FUntitled.png?width=1893&amp;table=block&amp;id=e588af9f-603f-43ec-bca2-5233666870f6" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/4361947a1e854e4fab851b3cdef95b4e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">一般來說我們會使用 F12 的選擇元素的功能直接看每一行的資料</span></span><div id="https://www.notion.so/ba52f5d7964344f7bdcc63005ec44e05" class="Image Image--Normal"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F3dbcef53-da4c-4288-96b1-10ae40035b47%2FUntitled.png?width=66&amp;table=block&amp;id=ba52f5d7-9643-44f7-bdcc-63005ec44e05"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F3dbcef53-da4c-4288-96b1-10ae40035b47%2FUntitled.png?width=66&amp;table=block&amp;id=ba52f5d7-9643-44f7-bdcc-63005ec44e05" style="width:66px"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div></li></ul><div id="https://www.notion.so/9c26f098d918499a8567c93115769454" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F10950615-1646-4f29-a07e-7e57757516ed%2Foutput.gif?width=1280&amp;table=block&amp;id=9c26f098-d918-499a-8567-c93115769454"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F10950615-1646-4f29-a07e-7e57757516ed%2Foutput.gif?width=1280&amp;table=block&amp;id=9c26f098-d918-499a-8567-c93115769454" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/cbd09a0af1904225b3db05d6d5115c0c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"></span></p></div><h2 id="https://www.notion.so/053332250718495289dcc5ac0b1a85a6" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/053332250718495289dcc5ac0b1a85a6"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">隱藏資料</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/5ae566e38aa84924b0d9b31a3e753616" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在每一行資料當中，你可以發現，還有一個內容豐富的頁面 “</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">課程名稱</strong></mark></span><span class="SemanticString">”，第一想法一定是覺得要打開才能抓取資料，沒事的，我們往下看</span></span></li><li id="https://www.notion.so/3e83a8e4f8f34b7c8969bdc4a23890c5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">首先，用選取元素指到課程名稱的地方，可以看到他呼叫了 callCoruseWindow 這個 function</span></span></li></ul><div id="https://www.notion.so/e5bc25bb9a7f4c029a6e211d2aed2fe5" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F1738eb4a-1087-4b6c-bb55-76cc9886ca72%2FUntitled.png?width=1153&amp;table=block&amp;id=e5bc25bb-9a7f-4c02-9a6e-211d2aed2fe5"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F1738eb4a-1087-4b6c-bb55-76cc9886ca72%2FUntitled.png?width=1153&amp;table=block&amp;id=e5bc25bb-9a7f-4c02-9a6e-211d2aed2fe5" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><div id="https://www.notion.so/56bfc8aaa2174a57b64187b362da2d0b" class="ColorfulBlock ColorfulBlock--BgRed Callout"><div class="Callout__Icon"><div class="Icon">🚨</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">因為 Google Chrome 會截斷程式碼，這邊請使用 Firefox</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/312f4c5ab1b14379a3f38a4214bf8283" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">為了避免過多資料，請先透過 “課程名稱” 只查詢一個課程，然後在開發工具搜尋 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">callCourseWindow</code></span><span class="SemanticString"> 你會發現有一長串程式碼</span></span></li></ul><div id="https://www.notion.so/8f98a3d9cebc45818502d698129d92de" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F62df245a-7d7b-4f96-80fa-9214c8fce5a9%2FUntitled.png?width=1482&amp;table=block&amp;id=8f98a3d9-cebc-4581-8502-d698129d92de"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F62df245a-7d7b-4f96-80fa-9214c8fce5a9%2FUntitled.png?width=1482&amp;table=block&amp;id=8f98a3d9-cebc-4581-8502-d698129d92de" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b86f05517e7e41ca8182b17ab1789c00" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">把一長串的程式碼複製貼上到 vscode (或其他 IDE; 記事本也可以)</span></span></li><li id="https://www.notion.so/6d1368af378040209fabf5cbb47bc2ff" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">貼上後搜尋 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">callCourseWindow</code></span><span class="SemanticString"> 尋找 function 實作的地方</span></span></li><li id="https://www.notion.so/8966d04dace845a59164f9dcba9aa25e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">你會看到非常有意思的一段程式碼</span></span></li></ul><div id="https://www.notion.so/2af9a6972b484b9192c591514244b309" class="ColorfulBlock ColorfulBlock--BgBlue Callout"><div class="Callout__Icon"><div class="Icon">👉🏻</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">這段程式碼我已放在 gist 上: </span><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://gist.github.com/Chinlinlee/445ed09289845c8abb26c45214612a92">https://gist.github.com/Chinlinlee/445ed09289845c8abb26c45214612a92</a></span></span></p></div><div id="https://www.notion.so/dd99a3b4fcff423a9a460beeda4154b5" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2Fef59a00b-2d7a-4179-9989-b401c87a835c%2FUntitled.png?width=1570&amp;table=block&amp;id=dd99a3b4-fcff-423a-9a46-0beeda4154b5"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2Fef59a00b-2d7a-4179-9989-b401c87a835c%2FUntitled.png?width=1570&amp;table=block&amp;id=dd99a3b4-fcff-423a-9a46-0beeda4154b5" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/ae5d54ff9fb84c9d8651950978b11db5" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">仔細看可以發現它使用 jquery 去選取大量資料，然後再產生彈出式視窗的內容</span></span></li><li id="https://www.notion.so/6addb2711d494f8bac7c12c5ea829a04" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">思考一下，這代表這些資料其實用在 HTML 上，所以我們回去資料行上面查看</span></span></li><li id="https://www.notion.so/d5531936676245f2909bb686d22b8382" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">最後可以在 “教師姓名” 的資料欄發現這一大串資料</span></span></li></ul><div id="https://www.notion.so/18bd458131c348f8873c0b73a3e60b0e" class="Image Image--PageWidth"><figure><a href="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F23689d32-16fc-4d94-aab3-a785d560818b%2FUntitled.png?width=1416&amp;table=block&amp;id=18bd4581-31c3-48f8-873c-0b73a3e60b0e"><img src="https://www.notion.so/signed/https%3A%2F%2Fprod-files-secure.s3.us-west-2.amazonaws.com%2Fce9dcb2e-e8b2-4683-8073-5dc0d1a91890%2F23689d32-16fc-4d94-aab3-a785d560818b%2FUntitled.png?width=1416&amp;table=block&amp;id=18bd4581-31c3-48f8-873c-0b73a3e60b0e" style="width:100%"/></a><figcaption><span class="SemanticStringArray"></span></figcaption></figure></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/682d42c3fd204e229efb36dca9df7551" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">這樣一來，我們就不需要去多花心思處理彈出式視窗的資料了！</span></span></li></ul><h1 id="https://www.notion.so/72d549a52e6a41ab853cc2e0c9c938a3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/72d549a52e6a41ab853cc2e0c9c938a3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">抓取資料</span></span></h1><div id="https://www.notion.so/96a76d0b6baa484bb5704870eb49903d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">以下我使用 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">Node.js</code></span><span class="SemanticString"> 語言，以及第三方套件管理器 pnpm 進行實作</span></span></p></div><h2 id="https://www.notion.so/c05125ef553c4ae6b757db266dfa6e3f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c05125ef553c4ae6b757db266dfa6e3f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">新建專案</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/f48d20d58d774caa9dcf79c4c0dda014" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在電腦找個合適的位置，創建資料夾命名為 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">course-crawler</code></span></span></li><li id="https://www.notion.so/df6219f0489248cfb22cfe658b21dd62" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">使用 pnpm 初始化專案</span></span></li></ul><pre id="https://www.notion.so/0238c817e3304a7283246a353e4c2537" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pnpm init</span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/cc9925accfba47f39459331f0ba64c63" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">在 </span><span class="SemanticString"><code class="SemanticString__Fragment SemanticString__Fragment--Code">package.json</code></span><span class="SemanticString"> 新增 type 為 module</span></span></li></ul><pre id="https://www.notion.so/61a5ddf4dfea45f8a9a7be00cfce472f" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token punctuation">{</span>
	<span class="token operator">...</span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
	<span class="token operator">...</span>
<span class="token punctuation">}</span></span></span></span></code></pre><h2 id="https://www.notion.so/7de824c0e302407792dcfb0561fb5776" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/7de824c0e302407792dcfb0561fb5776"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">安裝套件</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/6e4d6fcc7a0a4f06b4e0e15062ca8eda" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">puppeteer</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/f31f803de75448809246a713d7db0965" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Debug 瀏覽器的套件，提供各種 API 控制 Chrome</span></span></li></ul></li><li id="https://www.notion.so/3067363a488a4ea08966247ead8e18b3" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">cheerio</span></span><ul class="BulletedListWrapper"><li id="https://www.notion.so/77eb360f492340a4873fe495856929c4" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">讀取 html 透過類似 jQuery 的語法抓取網頁資料</span></span></li></ul></li></ul><pre id="https://www.notion.so/15ac8233ba324179b5d5372f3502d2e0" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>pnpm add puppeteer cherrio</span></span></span></code></pre><h2 id="https://www.notion.so/4566d730c34e46cd9888ecffc473c543" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4566d730c34e46cd9888ecffc473c543"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">程式碼</span></span></h2><div id="https://www.notion.so/74c92aa92dd84619a755921dfd8cb626" class="ColorfulBlock ColorfulBlock--BgBlue Callout"><div class="Callout__Icon"><div class="Icon">👉🏻</div></div><p class="Callout__Content"><span class="SemanticStringArray"><span class="SemanticString">建議至 Github 觀看: </span><span class="SemanticString"><span class="SemanticString__Fragment SemanticString__Fragment--Unknown">‣</span></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/3b6541a48bbb4e0480ac665d38f65109" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">以下的程式碼只專注在 “</span><span class="SemanticString"><mark class="SemanticString__Fragment SemanticString__Fragment--HighlightedBg SemanticString__Fragment--BgRed"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">抓取課程資訊和另存檔案成 JSON</strong></mark></span><span class="SemanticString">”</span></span></li></ul><h2 id="https://www.notion.so/0fb8f4899dfc47fdb783769d8f016793" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/0fb8f4899dfc47fdb783769d8f016793"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">index.js</span></span></h2><details id="https://www.notion.so/59beaa7099a64e3c8fb8d2413f1f7773" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">full code</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/1ee841d2e31a49daa4a250f7417cc6ce" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token keyword">import</span> fsP <span class="token keyword">from</span> <span class="token string">"fs/promises"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> puppeteer <span class="token keyword">from</span> <span class="token string">"puppeteer"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> sanitizeTime <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./utils.js"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">headless</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> dayNumMapping <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">"週一"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token string-property property">"週二"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token string-property property">"週三"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token string-property property">"週四"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
    <span class="token string-property property">"週五"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token string-property property">"週六"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
    <span class="token string-property property">"週日"</span><span class="token operator">:</span> <span class="token number">7</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 前往 "北護課程查詢系統" 頁面
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">gotoQueryPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">"https://system10.ntunhs.edu.tw/AcadInfoSystem/Modules/QueryCourse/QueryCourse.aspx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 選取最新學期
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">selectLastSemester</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 尋找 "選擇學期" 下拉式選單</span>
    <span class="token comment">// 為了防止網頁還未載入完成，所以使用了 waitForSelector， timeout 5 秒 </span>
    <span class="token keyword">let</span> semesterSelectElement <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">"#ContentPlaceHolder1_ddlSem"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span>
        <span class="token literal-property property">visible</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 選擇最新的學期</span>
    <span class="token comment">// nth-child(2)，選擇第二個是因為第一個是 "請選擇學期..."</span>
    <span class="token keyword">let</span> lastSemesterOption <span class="token operator">=</span> <span class="token keyword">await</span> semesterSelectElement<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"option:nth-child(2)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> lastSemester <span class="token operator">=</span> <span class="token keyword">await</span> lastSemesterOption<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> semesterSelectElement<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span>lastSemester<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">typeCourseName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> courseNameInput <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">"#ContentPlaceHolder1_txtCourseName"</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> courseNameInput<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"國文"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 點擊 "查詢" 按鈕
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">clickSearchButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 尋找 "查詢" 按鈕</span>
    <span class="token keyword">let</span> queryButton <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">"#ContentPlaceHolder1_btnQuery"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> queryButton<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 獲取最新學期所有課程資訊
 * @returns {Promise&lt;import("./type").Course[]>}
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getCoursesContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> courseTableBlock <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">waitForSelector</span><span class="token punctuation">(</span><span class="token string">"#ContentPlaceHolder1_NewGridView"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">1000</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> courses <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">/** @type { import("puppeteer").ElementHandle&lt;HTMLTableRowElement[]> } */</span>
    <span class="token keyword">let</span> trs <span class="token operator">=</span> <span class="token keyword">await</span> courseTableBlock<span class="token punctuation">.</span><span class="token function">$$</span><span class="token punctuation">(</span><span class="token string">"tr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> groups <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getGroupsInCoursesTable</span><span class="token punctuation">(</span>trs<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> groups<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/** @type { import("puppeteer").ElementHandle&lt;HTMLTableRowElement> } */</span>
        <span class="token keyword">let</span> tr <span class="token operator">=</span> <span class="token keyword">await</span> courseTableBlock<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"tr[group='"</span> <span class="token operator">+</span> groups<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">"']"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">/** @type { import("./type").Course } */</span>
            <span class="token keyword">let</span> course <span class="token operator">=</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">semester</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblSEMNo"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">department</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblGroupName"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">courseType</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblCourseTypeName"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">courseFullID</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidCOURSEFULLNO"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">courseName</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblCourseName"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">courseEngName</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidECOURSENAME"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">departmentID</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidGROUPNO"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">subjectID</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblCourseNo"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">subjectGroup</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidCOURSEGROUP"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">grade</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblGrade"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">classGroup</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblClass"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">credit</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblCredit"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidCLASSNAME"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">classID</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidCLASSNO"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">totalOfTakingStudents</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidTOTALFULLCNT"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">numberOfTakingStudents</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblTotalCNT"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">weekNumber</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidWEEKDESC"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">multipleTeacherName</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">div[id*="panMultipleTeachNameLinks"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">note</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblRemark"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">coursePlanRelativeUrl</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidUploadFile"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">courseAbstract</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidABSTRACT"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">courseEngAbstract</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="hidEABSTRACT"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

                <span class="token literal-property property">day</span><span class="token operator">:</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*=lblWeekNo]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>title<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>

            <span class="token keyword">let</span> mainTeacherNameEl <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">div[id*="panMainTeachNameLinks"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> mainTeacherName <span class="token operator">=</span> <span class="token keyword">await</span> mainTeacherNameEl<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            course<span class="token punctuation">.</span>mainTeacherName <span class="token operator">=</span> mainTeacherName<span class="token punctuation">;</span>

            <span class="token keyword">let</span> multipleTeacherNameEl <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">div[id*="panMultipleTeachNameLinks"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> multipleTeacherNames <span class="token operator">=</span> <span class="token keyword">await</span> multipleTeacherNameEl<span class="token punctuation">.</span><span class="token function">$$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">els</span> <span class="token operator">=></span> els<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            course<span class="token punctuation">.</span>multipleTeacherName <span class="token operator">=</span> multipleTeacherNames<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                course<span class="token punctuation">.</span>dayNum <span class="token operator">=</span> dayNumMapping<span class="token punctuation">[</span>course<span class="token punctuation">.</span>day<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                course<span class="token punctuation">.</span>dayNum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            

            <span class="token keyword">let</span> courseLocationID <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblRoomNo"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> courseLocationName <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblRoomNo"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> courseLocation <span class="token operator">=</span> courseLocationID <span class="token operator">?</span> courseLocationID <span class="token operator">:</span> courseLocationName<span class="token punctuation">;</span>
            course<span class="token punctuation">.</span>courseLocation <span class="token operator">=</span> courseLocation<span class="token punctuation">;</span>

            <span class="token keyword">let</span> period <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblSecNo"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>period<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> periods <span class="token operator">=</span> period<span class="token punctuation">.</span><span class="token function">matchAll</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(\d+)(?:~(\d+))?</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gm</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
                <span class="token keyword">let</span> startPeriod <span class="token operator">=</span> periods<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> endPeriod <span class="token operator">=</span> periods<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> periods<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">:</span> periods<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                course<span class="token punctuation">.</span>startPeriod <span class="token operator">=</span> startPeriod<span class="token punctuation">;</span>
                course<span class="token punctuation">.</span>endPeriod <span class="token operator">=</span> endPeriod<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                course<span class="token punctuation">.</span>startPeriod <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                course<span class="token punctuation">.</span>endPeriod <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">let</span> time <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">$eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">span[id*="lblSecNo"]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span>title<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> sanitizedTime <span class="token operator">=</span> <span class="token function">sanitizeTime</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
            course<span class="token punctuation">.</span>startTime <span class="token operator">=</span> sanitizedTime<span class="token punctuation">.</span>startTime<span class="token punctuation">;</span>
            course<span class="token punctuation">.</span>endTime <span class="token operator">=</span> sanitizedTime<span class="token punctuation">.</span>endTime<span class="token punctuation">;</span>

            courses<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>course<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token punctuation">(</span><span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"outerHTML"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">jsonValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> courses<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 尋找所有的 Group
 * 學校網站會把上下長度太長的表格拆分，所以要用 group 來分辨每個課程
 * group 是從 1 開始遞增的數值
 * @param {import("puppeteer").ElementHandle&lt;HTMLTableRowElement[]>} trs 
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getGroupsInCoursesTable</span><span class="token punctuation">(</span><span class="token parameter">trs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> groups <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> tr <span class="token keyword">of</span> trs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> group <span class="token operator">=</span> <span class="token keyword">await</span> tr<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token parameter">el</span> <span class="token operator">=></span> el<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"group"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>group<span class="token punctuation">)</span> groups<span class="token punctuation">[</span>group<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>groups<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 把課程資訊寫到 courses.json 檔案
 * @param {import("./type").Course[]} courses 
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">writeCoursesToFile</span><span class="token punctuation">(</span><span class="token parameter">courses</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> coursesString <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>courses<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> fsP<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">"courses.json"</span><span class="token punctuation">,</span> coursesString<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">doCraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">gotoQueryPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">selectLastSemester</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 快速測試用，只搜尋 "國文" 一門課</span>
    <span class="token comment">// await typeCourseName();</span>
    <span class="token keyword">await</span> <span class="token function">clickSearchButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> courses <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getCoursesContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">writeCoursesToFile</span><span class="token punctuation">(</span>courses<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"done"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">doCraw</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></span></span></code></pre></div></details><h2 id="https://www.notion.so/1b41a1b65a024b2cbc3fdd44f7acc866" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/1b41a1b65a024b2cbc3fdd44f7acc866"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">utils.js</span></span></h2><details id="https://www.notion.so/bf7932ba1f7b4f528e4690ead3262a8a" class="ColorfulBlock ColorfulBlock--ColorDefault Toggle "><summary class="Toggle__Summary"><span class="SemanticStringArray"><span class="SemanticString">full code</span></span></summary><div class="Toggle__Content"><pre id="https://www.notion.so/c73dc36ca0604232b7adaeaf6d42978a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token comment">/**
 * 
 * @param {string} time 
 */</span>
<span class="token keyword">function</span> <span class="token function">sanitizeTime</span><span class="token punctuation">(</span><span class="token parameter">time</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> removedChineseTime <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">節</span><span class="token regex-delimiter">/</span><span class="token regex-flags">gm</span></span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> firstLeftBracket <span class="token operator">=</span> removedChineseTime<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> firstTilde <span class="token operator">=</span> removedChineseTime<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> startTime <span class="token operator">=</span> removedChineseTime<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>firstLeftBracket <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> firstTilde<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> lastRightBracket <span class="token operator">=</span> removedChineseTime<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> lastTilde <span class="token operator">=</span> removedChineseTime<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> endTime <span class="token operator">=</span> removedChineseTime<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>lastTilde <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> lastRightBracket<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        startTime<span class="token punctuation">,</span>
        endTime
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> sanitizeTime <span class="token punctuation">}</span><span class="token punctuation">;</span></span></span></span></code></pre></div></details><h2 id="https://www.notion.so/4f03bc2c9ac54251831c560d2c0f09f9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/4f03bc2c9ac54251831c560d2c0f09f9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">輸出結果</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/27838b9c5f1b478e9394874621bb232e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">以下是單個課程輸出的結果</span></span></li></ul><pre id="https://www.notion.so/55c10411e4fe4c86863593cb62b8a077" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token string-property property">"semester"</span><span class="token operator">:</span> <span class="token string">"1122"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"department"</span><span class="token operator">:</span> <span class="token string">"二年制進修部護理系(日間班)"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseType"</span><span class="token operator">:</span> <span class="token string">"通識選修(通識)"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseFullID"</span><span class="token operator">:</span> <span class="token string">"11230028801370"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseName"</span><span class="token operator">:</span> <span class="token string">"休閒與生活"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseEngName"</span><span class="token operator">:</span> <span class="token string">"Leisure and Life"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"departmentID"</span><span class="token operator">:</span> <span class="token string">"11230"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"subjectID"</span><span class="token operator">:</span> <span class="token string">"0288"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"subjectGroup"</span><span class="token operator">:</span> <span class="token string">"01"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"grade"</span><span class="token operator">:</span> <span class="token string">"3"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"classGroup"</span><span class="token operator">:</span> <span class="token string">"70"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"credit"</span><span class="token operator">:</span> <span class="token string">"2"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"className"</span><span class="token operator">:</span> <span class="token string">"護進日二技3年70班"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"classID"</span><span class="token operator">:</span> <span class="token string">"11230370"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"totalOfTakingStudents"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string-property property">"numberOfTakingStudents"</span><span class="token operator">:</span> <span class="token string">"50"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"weekNumber"</span><span class="token operator">:</span> <span class="token string">"第1~14週"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"multipleTeacherName"</span><span class="token operator">:</span> <span class="token string">"吳旻穎"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"note"</span><span class="token operator">:</span> <span class="token string">"1.畢業班14週課程。\n修課限制：本系二技進修部、本系二技一般生、外系二技進修部、本系四技一般生、外系四技一般生、外系二技一般生、畢業班課程。\n本課程安排多次校外教學和戶外活動，欲選修前，請審慎評估自身體力、健康狀況及耐候程度，以確保個人安全。"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"coursePlanRelativeUrl"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseAbstract"</span><span class="token operator">:</span> <span class="token string">"本課程旨在從學生經由電影休閒活動，引導學生了解更深層生活之中的文化領域，再利用文學閱讀的休閒活動，更進一步進行個人的寫作創作，開發未獲運用的身心組織及功能，更積極地反饋為個人的成長，增進個人身心發展與成熟，進而轉換成品德與自我價值體系。"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseEngAbstract"</span><span class="token operator">:</span> <span class="token string">"The aim of this course is to guide students explore their culture by watching movies, reading books, and writing novel. To borrow the ideas of the movies, students can  create their own novel. In term of those leisure activities, students can develop their personal growth and create their value system."</span><span class="token punctuation">,</span>
        <span class="token string-property property">"day"</span><span class="token operator">:</span> <span class="token string">"週一"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"mainTeacherName"</span><span class="token operator">:</span> <span class="token string">"吳旻穎"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"dayNum"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string-property property">"courseLocation"</span><span class="token operator">:</span> <span class="token string">"F410"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"startPeriod"</span><span class="token operator">:</span> <span class="token string">"5"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"endPeriod"</span><span class="token operator">:</span> <span class="token string">"7"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"startTime"</span><span class="token operator">:</span> <span class="token string">"12:40"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"endTime"</span><span class="token operator">:</span> <span class="token string">"15:30"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span></span></span></span></code></pre></article>
<br />
<script src="https://utteranc.es/client.js"
  repo="Chinlinlee/Chinlinlee.github.io"
  issue-term="pathname"
  theme="github-light"
  crossorigin="anonymous"
  async>
</script>
  <footer class="Footer">
  <div>&copy; ChinLin’s Blog 2021-2024</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>
<script src="./scripts/code-copy.js"></script>
<script type="text/javascript" src="./scripts/table-of-contents-sidebar-lib/table-of-contents-sidebar.min.js"></script>
<script type="text/javascript">
    window.onload = function(e){
        TableOfContents.init({
            basePath: "./scripts/table-of-contents-sidebar-lib/",
            querySelector: "body" // or other css querySelector
        });
    }
</script>